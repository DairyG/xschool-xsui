<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<title></title>
		<link rel="stylesheet" href="../../layui/css/layui.css" />
		<link rel="stylesheet" href="../../layui/css/common.css" />
		<link rel="stylesheet" href="../../layui/css/liucheng.css" />
		<script type="text/javascript" src="../../lib/jquery-1.8.3.min.js"></script>
		<script type="text/javascript" src="../../layui/layui.js"></script>
		<script type="text/javascript" src="../../js/common.js"></script>
	</head>
	<body class="bgf2f2f2">
		<div class="childrenBody">
			<div class="layui-card-body bgwhite">
				<div class="layui-tab" lay-filter="component-tabs-brief">
					<ul class="layui-tab-title">
						<!-- 付款申请审批通过后 可直接发起付款申请 -->
						<li class="layui-this">基本信息</li>
						<li>内容设计</li>
						<li>流程设计</li>
						<span class="layui-btn fr" onclick="history.back(-1)">返回</span>
					</ul>
					<div class="layui-tab-content">
						<div class="layui-tab-item layui-show" tab-name="基本信息">
							<form class="layui-form layui-form2">
								<div class="layui-row">
									<div class="layui-form-item layui-col-md12 margin-b-20">
										<label class="layui-form-label"><span class="text-red"> *</span>流程名称</label>
										<div class="layui-input-block">
											<input type="text" name="title" required  lay-verify="required" placeholder="请输入流程名称" autocomplete="off" class="layui-input">
										</div>
									</div>
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label"><span class="text-red"> *</span>流程类型</label>
										<div class="layui-input-block">
											<select>
												<option>事务流程</option>
												<option>请款流程</option>
												<option>付款流程</option>
											</select>
										</div>
									</div>
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label"><span class="text-red"> *</span>所属分组</label>
										<div class="layui-input-block">
											<select>
												<option>请选择分组</option>
												<option>用车申请</option>
												<option>招聘申请</option>
											</select>
										</div>
									</div>
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label"><span class="text-red"> *</span>可见范围</label>
										<div class="layui-input-block">
											<input type="text" name="title" required  lay-verify="required" placeholder="请选择可见范围" autocomplete="off" class="layui-input" onclick="user_popup()"/>
										</div>
									</div>
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label">流程图标</label>
										<div class="layui-input-block">
											<div class="margin-t-3">
												<span class="layui-btn layui-btn-sm layui-btn-normal">上传图标</span>
											</div>
										</div>
									</div>
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label">流程描述</label>
										<div class="layui-input-block">
											<input type="text" name="title" required  lay-verify="required" placeholder="请输入流程描述" autocomplete="off" class="layui-input">
										</div>
									</div>
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label">审批意见</label>
										<div class="layui-input-block">
											<input type="checkbox" title="必填" lay-skin="primary" />
										</div>
									</div>
								</div>
								<div class="layui-row text-right">
									<button class="layui-btn layui-btn-danger" lay-submit lay-filter="submit">下一步</button>
									<span class="layui-btn" onclick="history.back(-1)">返回</span>
								</div>
							</form>
						</div>
						<div class="layui-tab-item" tab-name="内容设计">
							<form class="layui-form layui-form2">
								<div class="layui-row">
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label"><span class="text-red"> *</span>请款名称</label>
										<div class="layui-input-block">
											<input type="text" name="title" required lay-verify="required" placeholder="请输入请款名称" autocomplete="off" class="layui-input">
										</div>
									</div>
									<!-- 部门只拉去当前用户关联的部门 -->
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label"><span class="text-red"> *</span>申请部门</label>
										<div class="layui-input-block">
											<select>
												<option>财务公司-财务部</option>
												<option>建设公司-销售部</option>
											</select>
										</div>
									</div>
									<!-- 选择了部门后才能选择预算科目 -->
									<div class="layui-form-item layui-col-md12 margin-b-20">
										<label class="layui-form-label"><span class="text-red"> *</span>预算科目</label>
										<div class="layui-input-block">
											<div class="layui-input">
												<div class="layui-input-inline input-select " style="width: 150px;">
													<select>
														<option>一级费用科目</option>
														<option>建设成本</option>
														<option>费用预算</option>
														<option>固定资产</option>
													</select>
												</div>
												<div class="layui-input-inline input-select" style="width:150px;">
													<select >
														<option>二级费用科目</option>
														<option>二级费用项1</option>
														<option>二级费用项2</option>
													</select>
												</div>
											</div>
										</div>
									</div>
									<!-- 总预算和剩余预算 根据选择的预算科目获取 -->
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label"><span class="text-red"> *</span>科目总预算</label>
										<div class="layui-input-block">
											<input type="text" name="title" required readonly lay-verify="required" placeholder="科目总预算" autocomplete="off" class="layui-input">
										</div>
									</div>
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label"><span class="text-red"> *</span>剩余预算</label>
										<div class="layui-input-block">
											<input type="text" name="title" required readonly lay-verify="required" placeholder="剩余预算" autocomplete="off" class="layui-input">
										</div>
									</div>
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label"><span class="text-red"> *</span>本月预算</label>
										<div class="layui-input-block">
											<input type="text" name="title" required readonly lay-verify="required" placeholder="本月预算" autocomplete="off" class="layui-input">
										</div>
									</div>
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label"><span class="text-red"> *</span>累计发生</label>
										<div class="layui-input-block">
											<input type="text" name="title" required readonly lay-verify="required" placeholder="累计发生" autocomplete="off" class="layui-input">
										</div>
									</div>
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label"><span class="text-red"> *</span>申请金额</label>
										<div class="layui-input-block">
											<input type="text" name="title" required lay-verify="required" placeholder="请输入申请金额" autocomplete="off" class="layui-input">
										</div>
									</div>
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label">处理时效</label>
										<div class="layui-input-block">
											<!-- 普通 48小时内处理 紧急 24小时内处理 -->
											<select>
												<option>普通</option>、
												<option>紧急</option>
											</select>
										</div>
									</div>
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label"><span class="text-red"> *</span>付款次数</label>
										<div class="layui-input-block">
											<input type="radio" name="pay_num" title="单次付款" value="1" lay-filter="pay_num">
											<input type="radio" name="pay_num" title="多次付款" value="2" lay-filter="pay_num">
										</div>
									</div>
									<div class="layui-form-item layui-col-md12 margin-b-20" id="pay_table_item" style="display:none">
										<label class="layui-form-label"><span class="text-red"> *</span>付款次数</label>
										<div class="layui-input-block">
											<table class="layui-table">
												<thead>
													<tr>
														<th width="60">序号</th>
														<th>款项名称</th>
														<th>比例</th>
														<th>金额</th>
														<th>付款日期</th>
														<th>备注</th>
													</tr>
												</thead>
												<tbody>
													<tr>
														<td><span class="table-btn-jia">+</span><span class="table-btn-jian">-</span></td>
														<td><input type="text" class="layui-input"></td>
														<td><input type="text" class="layui-input"></td>
														<td><input type="text" class="layui-input"></td>
														<td><input type="text" class="layui-input date" readonly></td>
														<td><input type="text" class="layui-input" readonly onclick="layui_prompt(this)"></td>
													</tr>
													<tr>
														<td></td>
														<td>合计</td>
														<td>0</td>
														<td>0</td>
														<td></td>
														<td></td>
													</tr>
													<!-- 提交时验证比例和是否为100%，金额总计和是否和总金额相等 不相等时弹出提示-->
												</tbody>
											</table>
										</div>
									</div>
									<div class="layui-form-item layui-col-md6 margin-b-20">
										<label class="layui-form-label">附件</label>
										<div class="layui-input-block">
											<div class="margin-t-3">
												<span class="layui-btn layui-btn-sm layui-btn-normal">上传附件</span>
											</div>
										</div>
									</div>
								</div>
								<div class="layui-row">
									<div class="layui-form-item">
										<div class="layui-input-block text-right">
											<button class="layui-btn layui-btn-danger" lay-submit lay-filter="submit">下一步</button>
											<span class="layui-btn" onclick="history.back(-1)">返回</span>
										</div>
									</div>
								</div>
							</form>
						</div>
						<div class="layui-tab-item" tab-name="流程设计">
							<form class="layui-form process_add_form">
								<div class="layui-form-item">
									<div style="width: 400px;margin:0 auto">
										<ul class="process_box">
											<li>
												<div class="layui-card faqi_card">
													<div class="layui-card-header">发起人</div>
													<div class="layui-card-body">
														<div class="show_div">
															所有人
														</div>
													</div>
												</div>
												<div class="process_add_btn_item">
													<label>
														<i class="layui-icon layui-icon-add-circle" onclick="show_add_item(this)"></i>
														<input type="radio" name="add_item_point" lay-ignore />
													</label>
												</div>
											</li>
											<li>
												<div class="layui-card shenpi_card">
													<div class="layui-card-header">审批人</div>
													<div class="layui-card-body">
														<div class="show_div"><span class="text-85">请选择审批人</span></div>
														<label class="add_icon text-85">
															<i class="layui-icon layui-icon-right fr fontsize-18"></i>
															<input type="radio" name="add_item_point" lay-ignore  onclick="on_select(this)"/>
														</label>
													</div>
												</div>
												<div class="process_add_btn_item">
													<label>
														<i class="layui-icon layui-icon-add-circle" onclick="show_add_item(this)"></i>
														<input type="radio" name="add_item_point" lay-ignore />
													</label>
												</div>
											</li>
											<li>
												<div class="layui-card cahosong_card">
													<div class="layui-card-header">抄送人<i class="layui-icon layui-icon-close-fill fr fontsize-18" onclick="close_item(this)"></i></div>
													<div class="layui-card-body">
														<!-- 一个人时显示 人名称 多个人时显示人数+会签（例 4人会签） -->
														<div class="show_div"><span class="text-85">请选择抄送人</span></div>
														<label class="add_icon text-85">
															<i class="layui-icon layui-icon-right fr fontsize-18"></i>
															<input type="radio" name="add_item_point" lay-ignore  onclick="on_select(this)"/>
														</label>
													</div>
												</div>
												<div class="process_add_btn_item">
													<label>
														<i class="layui-icon layui-icon-add-circle" onclick="show_add_item(this)"></i>
														<input type="radio" name="add_item_point" lay-ignore />
													</label>
												</div>
											</li>
											<li>
												<div class="layui-card fupan_card">
													<div class="layui-card-header">复盘人</div>
													<div class="layui-card-body text-center">
														<input type="checkbox" title="发起人必填" lay-skin="primary" />
														<input type="checkbox" title="部门经理必填" lay-skin="primary"/>
													</div>
												</div>
												<div class="process_add_btn_item process_add_btn_item_end">
												</div>
												<p class="text-center text-85">流程结束</p>
											</li>
										</ul>
									</div>
								</div>
								<div class="layui-row text-right">
									<button class="layui-btn layui-btn-danger" lay-submit lay-filter="submit">确认</button>
									<span class="layui-btn" onclick="history.back(-1)">返回</span>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="linePop linePop1">
			<div class="layui-card-body padding-r-50">
				<form class="layui-form layui-form2" >
					<div class="layui-row">
						<div class="layui-form-item layui-col-md12 margin-b-20">
							<label class="layui-form-label"><span class="text-red"> *</span>分组名称</label>
							<div class="layui-input-block">
								<input type="text" name="title" required  lay-verify="required" placeholder="请输入分组名称" autocomplete="off" class="layui-input">
							</div>
						</div>
					</div>	
					<div class="layui-row text-right">
						<button class="layui-btn" lay-submit="" lay-filter="formDemo">确认</button>
						<span class="layui-btn layui-btn-primary" onclick="closePop()">返回</span>
					</div>
				</form>
			</div>
		</div>
		<div class="linePop linePop2">
			<div class="layui-card-body padding-r-50">
				<form class="layui-form layui-form2" >
					<div class="layui-row">
						<div class="layui-form-item layui-col-md12 margin-b-20">
							<label class="layui-form-label"><span class="text-red"> *</span>分组</label>
							<div class="layui-input-block">
								<select>
									<option></option>
									<option>用车申请</option>
									<option>请假申请</option>
									<option>资源申请</option>
									<option>用车申请</option>
									<option>请假申请</option>
									<option>资源申请</option>
									<option>用车申请</option>
									<option>请假申请</option>
									<option>资源申请</option>
								</select>
							</div>
						</div>
					</div>	
					<div class="layui-row text-right">
						<button class="layui-btn" lay-submit="" lay-filter="formDemo">确认</button>
						<span class="layui-btn layui-btn-primary" onclick="closePop()">返回</span>
					</div>
				</form>
			</div>
		</div>
		<script type="text/html" id="shenpi_html">
			<div class="layui-card shenpi_card">
				<div class="layui-card-header">审批人<i class="layui-icon layui-icon-close-fill fr fontsize-18" onclick="close_item(this)"></i></div>
				<div class="layui-card-body">
					<div class="show_div"><span class="text-85">请选择审批人</span></div>
					<label class="add_icon text-85">
						<i class="layui-icon layui-icon-right fr fontsize-18"></i>
						<input type="radio" name="add_item_point" lay-ignore  onclick="on_select(this)"/>
					</label>
				</div>
			</div>
			<div class="process_add_btn_item">
				<label>
					<i class="layui-icon layui-icon-add-circle" onclick="show_add_item(this)"></i>
					<input type="radio" name="add_item_point" lay-ignore />
				</label>
			</div>
		</script>
		<script type="text/html" id="chaosong_html">
			<div class="layui-card cahosong_card">
				<div class="layui-card-header">抄送人<i class="layui-icon layui-icon-close-fill fr fontsize-18" onclick="close_item(this)"></i></div>
				<div class="layui-card-body">
					<div class="show_div"><span class="text-85">请选择抄送人</span></div>
					<label class="add_icon text-85">
						<i class="layui-icon layui-icon-right fr fontsize-18"></i>
						<input type="radio" name="add_item_point" lay-ignore  onclick="on_select(this)"/>
					</label>
				</div>
			</div>
			<div class="process_add_btn_item">
				<label>
					<i class="layui-icon layui-icon-add-circle" onclick="show_add_item(this)"></i>
					<input type="radio" name="add_item_point" lay-ignore />
				</label>
			</div>
		</script>
		<div class="linePop linePop3" id="add_item" >
			<div class="layui-row add_item">
				<div class="layui-col-md6 text-center">
					<label href="javascript:;" onclick="add_item('shenpi')">
						<i class="layui-icon layui-icon-survey text-add"></i>
						<span>审批人</span>
					</label>
				</div>
				<div class="layui-col-md6 text-center">
					<label href="javascript:;" onclick="add_item('chaosong')">
						<i class="layui-icon layui-icon-release text-edit"></i>
						<span>抄送人</span>
					</label>
				</div>
			</div>
		</div>
		<div class="linePop linePop4" >
			<div class="layui-row add_item">
				<div class="layui-col-md6 text-center">
					<label href="javascript:;" onclick="user_popup(null,true,false,false,0,true)">
						<i class="layui-icon layui-icon-group text-add"></i>
						<span>指定成员</span>
					</label>
				</div>
				<div class="layui-col-md6 text-center">
					<label href="javascript:;" onclick="done_select('duty')">
						<i class="layui-icon layui-icon-friends text-edit"></i>
						<span>部门负责人</span>
					</label>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			var layer_linePop;
			layui.use(['table','element','form','laydate'], function() {
				var table = layui.table,
					element = layui.element,
					form = layui.form,
					laydate = layui.laydate;
					lay('.date').each(function(){
						laydate.render({
							elem:this
						});
					});
				form.on('radio(pay_num)',function(obj){
					if(obj.value == '1'){
						$("#pay_table_item").hide();
					} else {
						$("#pay_table_item").show();
					}
				});
			});
			function add_group(){
				layer_linePop = layer.open({
					type: 1,
					title:'添加分组',
					String: false,
					closeBtn: 1,
					skin: 'layui-layer-rim',
					area: '750px',
					content: $('.linePop1')
				});
			}
			function process_move(){
				layer_linePop = layer.open({
					type: 1,
					title:'移动分组',
					String: false,
					closeBtn: 1,
					skin: 'layui-layer-rim',
					area: ['750px','450px'],
					content: $('.linePop2')
				});
			}
			function show_add_item(obj){
				layer_linePop = layer.open({
					type: 1,
					title:'添加流程项',
					String: false,
					closeBtn: 1,
					skin: 'layui-layer-rim',
					area: ['350px','160px'],
					content: $('.linePop3')
				});
			}
			function add_item(type){
				var html = $("#"+type+"_html").html();
				var p_li = $("input[name='add_item_point']:checked").parents('li');
				$(p_li).after('<li>'+html+'</li>');
				closePop();
			}
			function on_select(obj){
				/* layer_linePop = layer.open({
					type: 1,
					title:'选择人员类型',
					String: false,
					closeBtn: 1,
					skin: 'layui-layer-rim',
					area: ['350px','160px'],
					content: $('.linePop4')
				}); */
				user_popup2(null,true,true,true);
			}
			function done_select(type){
				if(type == 'duty'){//部门负责人
					var p_li = $("input[name='add_item_point']:checked").parents('li');
					$(p_li).find('.show_div').html('部门负责人');
				}
				closePop();
			}
			function close_item(obj){
				$(obj).parents('li').remove();
			}
			function closePop(){
				layer.close(layer_linePop);
			}
		</script>
	</body>
</html>